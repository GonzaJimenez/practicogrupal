<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;600;700;800&amp;display=swap" />
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/lightDark.css">
    <link rel="stylesheet" href="css/cargaCRUD.css">
    <title>Sanus Vita</title>
    <link rel="icon" type="imcantidad/png" sizes="32x32" href="img/ico.png"">
    <!-- <link rel=" stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> -->
</head>

<body class=" dark-theme">
    <header class="" id="idheader">
    </header>

    <main>

        <div id="app" class="app">
            <h4 class="head"> CRUD</h4>
            <div class="container">
                <table class="table-responsive bordered highlight centered hoverable z-depth-2"
                    v-show="suplementos.length">
                    <thead>
                        <tr>
                            <th v-for="column in columns">
                                {{column}}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(suplemento,codigo) in suplementos">
                            <td>{{codigo}}</td>
                            <td>
                                {{suplemento.nombre}}
                            </td>
                            <td>
                                {{suplemento.descripcion}}
                            </td>
                            <td>
                                {{suplemento.cantidad}}
                            </td>
                            <td>
                                {{suplemento.precio}}
                            </td>
                            <td class="btns">
                                <a href="#modal" @click="edit(codigo)" class="btn editar"><svg
                                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-edit">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg></i>
                                </a>
                                <a href="#!" class="btn delete" @click="archive(codigo)"><svg
                                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-trash-2">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path
                                            d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                        </path>
                                        <line x1="10" y1="11" x2="10" y2="17"></line>
                                        <line x1="14" y1="11" x2="14" y2="17"></line>
                                    </svg></i>
                                </a>
                            </td>
                        </tr>
                        <tr id="formulario">
                            <td>
                                <div class="input-field">
                                    <input placeholder="123" v-model="input.codigo" id="codigo"
                                        type="text">
                                    <label for="codigo">Codigo</label>
                                </div>
                            </td>
                            <td>
                                <div class="input-field">
                                    <input placeholder="Nombre" ref="nombre" v-model="input.nombre" id="nombre"
                                        type="text">
                                    <label for="nombre">Nombre</label>
                                </div>
                            </td>
                            <td>
                                <div class="input-field">
                                    <input placeholder="Descripción" v-model="input.descripcion" id="descripcion"
                                        type="text">
                                    <label for="descripcion">Descripción</label>
                                </div>
                            </td>
                            <td>
                                <div class="input-field">
                                    <input placeholder="Cantidad" v-model="input.cantidad" id="cantidad" type="text">
                                    <label for="cantidad">Cantidad</label>
                                </div>
                            </td>
                            <td>
                                <div class="input-field">
                                    <input placeholder="Precio" v-model="input.precio" id="precio" type="text">
                                    <label for="precio">Precio</label>
                                </div>
                            </td>
                            <td>
                                <button type="submit" class="btn add">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                        width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                        class="feather feather-plus">
                                        <line x1="12" y1="5" x2="12" y2="19"></line>
                                        <line x1="5" y1="12" x2="19" y2="12"></line>add
                                    </svg>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <table class="table-responsive centered bordered striped highlight z-depth-1 hoverable"
                    v-show="bin.length">
                    <thead>
                        <tr>
                            <th v-for="column in columns">
                                {{column}}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(suplemento,codigo) in bin">
                            <td>{{codigo}}</td>
                            <td>
                                {{suplemento.nombre}}
                            </td>
                            <td>
                                {{suplemento.descripcion}}
                            </td>
                            <td>
                                {{suplemento.cantidad}} years
                            </td>
                            <td>
                                {{suplemento.precio}}
                            </td>
                            <td>
                                <a href="#!" @click="restore(codigo)"
                                    class="btn waves-effect waves-light blue darken-2"><i
                                        class="material-icons">restore</i>
                                </a>
                                <button @click="eliminarSuplemento(suplemento.codigo)"><i
                                        class="material-icons">delete</i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="modal" class="edit">
                <div class="edit-c container">
                    <h4 class="center-align">Editar</h4>
                    <p class="center-align">Formulario de edición</p>
                    <div class="row">
                        <form class="col s12">
                            <div class="row">
                                <div class="input-field col s6">
                                    <input placeholder="Nombre del producto" id="last_name" type="text"
                                        v-model="editInput.nombre">
                                    <label for="last_name">Nombre</label>
                                </div>
                                <div class="input-field col s6">
                                    <input placeholder="Descripción breve" id="first_name" type="text"
                                        v-model="editInput.descripcion">
                                    <label for="first_name">Descripción</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s6">
                                    <input placeholder="Ingrese cantidad" id="edit_cantidad" type="text"
                                        v-model="editInput.cantidad">
                                    <label for="edit_cantidad">Cantidad</label>
                                </div>
                                <div class="input-field col s6">
                                    <input placeholder="$$$" id="edit_precio" type="text" v-model="editInput.precio">
                                    <label for="edit_precio">Precio</label>
                                </div>
                            </div>
                            <!-- <div class="row">
                                <div class="input-field col s12">
                                    <input placeholder="Address" id="edit_address" type="text"
                                        v-model="editInput.address">
                                    <label for="edit_address">First Name</label>
                                </div>
                            </div> -->
                        </form>
                    </div>
                </div>
                <div class="edit-f">
                    <a href="#!" class="close modal-action modal-close waves-effect waves-green btn-flat">Close</a>
                    <a href="#!" @click="update" class="btn waves-effect waves-light"><i
                            class="material-icons">edit</i></a>
                </div>
            </div>
        </div>
    </main>

    <footer id="idfooter">
    </footer>
    <script defer src=" js/darkMode.js"></script>
    <script defer src="js/header.js"></script>
    <script src="js/index.js"></script>
    <script src="js/form.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script>
        const URL = "https://evannj.pythonanywhere.com/";
        
        document.getElementById('formulario').addEventListener('submit',

            function (event) {
                event.preventDefault() // Evitamos que se recargue la página
                // Obtenemos los valores del formulario
                var codigo = document.getElementById('codigo').value
                var nombre = document.getElementById('nombre').value
                var descripcion = document.getElementById('descripcion').value
                var cantidad = document.getElementById('cantidad').value
                var precio = document.getElementById('precio').value
                // Creamos un objeto con los datos del producto
                var suplemento = {
                    codigo: codigo,
                    nombre: nombre,
                    descripcion: descripcion,
                    cantidad: cantidad,
                    precio: precio
                }
                console.log(suplemento)
                // Realizamos la solicitud POST al servidor
                fetch(URL + 'suplementos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(suplemento)
                })
                    .then(function (response) {
                        if (response.ok) {
                            return response.json() // Parseamos la respuesta JSON
                        } else {
                            throw new Error('Error al agregar el suplemento.')
                        }
                    })
                    .then(function (data) {
                        alert('Producto agregado correctamente.')
                        document.getElementById('codigo').value = ""
                        document.getElementById('nombre').value = ""
                        document.getElementById('descripcion').value = ""
                        document.getElementById('cantidad').value = ""
                        document.getElementById('precio').value = ""
                    })
                    .catch(function (error) {
                        console.log('Error:', error)
                        alert('Error al agregar el producto.')
                    })
            })

        new Vue({
            el: '#app',
            data: {
                columns: ['Codigo', 'Nombre', 'Descripción', 'Cantidad', 'Precio', 'Actions'],
                suplementos: [],
                bin: [],
                input: {
                    nombre: "",
                    descripcion: "",
                    cantidad: "",
                    precio: "",
                },
                editInput: {
                    nombre: "",
                    descripcion: "",
                    cantidad: "",
                    precio: "",
                }
            },
            created() {
                this.obtenerSuplementos();
            },
            methods: {
                obtenerSuplementos() {
                    fetch(URL + 'suplementos')
                        .then(response => {
                            if (response.ok) {
                                return response.json()
                            } else {
                                throw new Error('Error al obtener los suplementos.')
                            }
                        })
                        .then(data => {
                            this.suplementos = data
                        })
                        .catch(error => {
                            console.log('Error:', error)
                            alert('Error al obtener los suplementos.')
                        })
                },
                //function to add data to table
                add: function () {
                    this.suplementos.push({
                        nombre: this.input.nombre,
                        descripcion: this.input.descripcion,
                        cantidad: this.input.cantidad,
                        precio: this.input.precio,
                    });

                    for (var key in this.input) {
                        this.input[key] = '';
                    }
                    this.suplementos.sort(ordonner);
                    this.$refs.nombre.focus();
                },
                //function to handle data edition
                edit: function (codigo) {
                    this.editInput = this.suplementos[codigo];
                    console.log(this.editInput);
                    this.suplementos.splice(codigo, 1);
                },
                //function to send data to bin
                archive: function (codigo) {
                    this.bin.push(this.suplementos[codigo]);
                    this.suplementos.splice(codigo, 1);
                    this.bin.sort(ordonner);
                },
                //function to restore data
                restore: function (codigo) {
                    this.suplementos.push(this.bin[codigo]);
                    this.bin.splice(codigo, 1);
                    this.bin.sort(ordonner);
                },
                //function to update data
                update: function () {
                    // this.suplementos.push(this.editInput);
                    this.suplementos.push({
                        nombre: this.editInput.nombre,
                        descripcion: this.editInput.descripcion,
                        cantidad: this.editInput.cantidad,
                        precio: this.editInput.precio,
                    });
                    for (var key in this.editInput) {
                        this.editInput[key] = '';
                    }
                    this.suplementos.sort(ordonner);
                },
                obtenerlista() {
                    fetch(URL + 'suplementos')
                        .then(response => response.json())
                        .then(data => {
                            this.codigosSuplementos = data.map(suplemento => suplemento.codigo)

                        })
                        .catch(error => {
                            alert('Error al obtener la lista de codigos.')
                        })
                },
                guardarCambios() {
                    const suplemento = {
                        codigo: this.codigo,
                        nombre: this.nombre,
                        descripcion: this.descripcion,
                        cantidad: this.cantidad,
                        precio: this.precio
                    }

                    fetch(URL + 'suplementos/' + this.codigo, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(suplemento)
                    })
                        .then(response => {
                            if (response.ok) {
                                return response.json()
                            } else {
                                throw new Error('Error al guardar los cambios del suplemento.')
                            }
                        })
                        .then(data => {
                            alert('Cambios guardados correctamente.')
                            location.reload()
                        })
                        .catch(error => {
                            alert('Error al guardar los cambios del suplemento.')
                        })
                },
                eliminarSuplemento(codigo) {
                    const URL = "https://evannj.pythonanywhere.com/"
                    fetch(URL + `suplementos/${codigo}`, { method: 'DELETE' })
                        .then(response => {
                            if (response.ok) {
                                // Eliminar el producto de la lista después de eliminarlo en el servidor
                                this.suplementos = this.suplementos.filter(suplemento => suplemento.codigo !== codigo)
                                console.log('Suplemento eliminado correctamente.')
                            }
                        })
                        .catch(error => {
                            console.log('Error:', error)
                            alert('Error al eliminar el suplemento.')
                        })
                }
            }
        });

        //function to sort table data alphabetically
        var ordonner = function (a, b) {
            return (a.nombre > b.nombre);
        };

        
    </script>

</body>

</html>